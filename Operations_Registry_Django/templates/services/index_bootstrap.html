{% extends "services/base.html" %}

{% block title %}Services Registry{% endblock %}

{% block content %}


{% if expand_all %}
    <a href="{% url 'services:index' %}?expand_all=0"
        class="btn btn-default" role="button"
        style="color:green; margin-bottom:15px;">
        <span class="glyphicon glyphicon-chevron-up"></span>
        Collapse All</a>
{% else %}
    <a href="{% url 'services:index' %}?expand_all=1"
        class="btn btn-default" role="button"
        style="color:green; margin-bottom:15px;">
        <span class="glyphicon glyphicon-chevron-down"></span>
        Expand All</a>
{% endif %}

<div class="panel-group" id="accordian">
    {% for s in services %}
        {# this allows only one to be expanded at a time: #}
        {% comment %}
        <a data-toggle="collapse" data-parent="#accordian"
            href="#{{ s.service.name|slugify }}">
            {{ s.service.name }}</a>
        {% endcomment %}

        {# this allows any to be expanded #}
        {% comment %}
        <a data-toggle="collapse"
            data-target="#{{ s.service.name|slugify }}">
            {{ s.service.name }}</a>
        {% endcomment %}
        <button type="button" class="btn btn-default btn-block"
            data-toggle="collapse"
            data-target="#{{ s.service.name|slugify }}">
            <h4 class="text-left" style="margin-left:10px;">
                {% if s.service.deprecated %}
                    <del style="color:#ccc;">{{ s.service.name }}</del>
                    <small style="color:#d9534f;">DEPRECATED</small>
                {% else %}
                    {{ s.service.name }}
                {% endif %}
            </h4>
        </button>

        <div id="{{ s.service.name|slugify }}"
            {% if expand_all %} class="collapse in"
            {% else %} class="collapse"{% endif %}>
            <div class="panel panel-default">
                <div class="panel-body">
                    <p>{{ s.service.description }}</p>

                    <div class="well well-sm">
                        <strong>Hostname:</strong>
                        {{ s.service.hostname }}
                        <br />
                        <div class="row">
                            <div class="col-md-3">
                                <strong>Load Balanced:</strong>
                                {{ s.service.lb|yesno }}
                                <br />
                                <strong>High Availability:</strong>
                                {{ s.service.ha|yesno }}
                                <br />
                                <strong>OTP Enabled:</strong>
                                {{ s.service.otp|yesno }}
                            </div>
                            <div class="col-md-4">
                                <strong>Dependencies:</strong>
                                {{ s.service.dependencies }}
                                <br />
                                <strong>Failover:</strong>
                                {{ s.service.failover_process }}
                                <br />
                                <strong>Failover last tested:</strong>
                                {{ s.service.failover_last_tested|date:"m/d/Y" }}
                            </div>
                            <div class="col-md-5">
                                <strong> Service checked by Nagios: </strong>
                                {{ s.service.nagios | yesno }}
                                <br />
                                <strong>Service last verified:</strong>
                                {{ s.service.service_last_verified|date:"m/d/Y" }}
                            </div>
                        </div> <!-- row -->
                    </div> <!-- well -->

                    <p>HOSTS:</p>
                    {% for h in s.hosts %}
                        <div class="well well-sm">
                        <div class="row">
                            <div class="col-md-2">
                                <span class="label label-primary">
                                {{ h.label|upper }}
                                </span>
                            </div>
                            <div class="col-md-10">
                                {#<strong>Hostname:</strong>#}
                                {{ h.hostname }}
                            </div>
                        </div> <!-- row -->
                        <div class="row">
                            <div class="col-md-6">
                                <strong>Location:</strong>
                                {{ h.location }}<br />
                                <strong>IP:</strong>
                                {{ h.ip_address }}<br />
                                <strong>Avail:</strong>
                                {{ h.availability }},
                                {{ h.support }}
                                <br />
                                <strong>Scanned by Qualys:</strong>
                                {{ h.qualys|yesno }}
                                <br />
                                <strong> Host last verified: </strong>
                                {{h.host_last_verified}}
                                </div>
                            <div class="col-md-6">
                                <strong>Sys Admin:</strong>
                                {{ h.sys_admin.last_name }}, {{ h.sys_admin.name }}
                                <a href="mailto:{{ h.sys_admin.email }}">
                                {{ h.sys_admin.email }}</a>
                                {{ h.sys_admin.phone }}<br />
                                <strong>Primary POC:</strong>
                                {{ h.poc_primary.last_name }}, {{ h.poc_primary.name }}
                                <a href="mailto:{{ h.poc_primary.email }}">
                                {{ h.poc_primary.email }}</a>
                                {{ h.poc_primary.phone }}<br />
                                <strong>Backup POC:</strong>
                                {{ h.poc_backup.last_name }}, {{ h.poc_backup.name }}
                                <a href="mailto:{{ h.poc_backup.email }}">
                                {{ h.poc_backup.email }}</a>
                                {{ h.poc_backup.phone }}<br/>
                                <strong>Checked by Nagios:</strong>
                                       {{h.nagios|yesno }}
                            </div>
                        </div> <!-- row -->

                        {% if h.note %}
                            <div class="row">
                                <div class="col-md-12">
                                    <strong>Note: </strong>{{ h.note }}</div>
                            </div> <!-- row -->
                        {% endif %}

                        </div> <!-- well -->
                    {% endfor %} <!-- instances loop -->


                <p>LINKS:</p>
                <div class="row">
                    <div class="col-md-10">
                        <ul>
                            {% for link in s.service.link_set.all %}
                            <li><a href="{{ link.url }}">{{ link.url }}</a>
                            [{{ link.description }}]</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% if not s.service.deprecated and editor %}
                    <div class="col-md-2">
                        <a href="{% url 'services:edit' s.service.id %}"
                            class="btn btn-default"
                            style="color:green;"
                            role="button">
                            <span class="glyphicon glyphicon-pencil"></span>
                            Edit Entry</a>
                    </div>
                    {% endif %}
                </div> <!-- row -->
                <p>LOG:</p>
                <div class="row">
                    <div class="col-md-10">
                        <ul>
                            {#<p><b>LOG</b></p>#}
                            {% for le in s.log %}
                                <li>
                                <b>{{ le.timestamp|date:"M d, Y P" }}</b>
                                {{ le.msg }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>

                </div> <!-- panel-body -->
            </div> <!-- panel -->
        </div> <!-- collapse -->
    {% endfor %} <!-- services loop -->
</div> <!-- panel-group -->
{% endblock %}

{% extends "services/base.html" %}
{% load get_settings %}

{% block title %}Add Service{% endblock %}

{% block content %}


{% comment %}
<p>form errors</p>
<ul>
{% for iform in host_formset %}
{% for field,errors in iform.errors.items %}
    {% for error in errors %}
        <li>{{ field }}: {{ error }}</li>
        {# <li>{{ error }}</li> #}
    {% endfor %}
{% endfor %}
{% endfor %}
</ul>

<p>Debug: {{ debug }}</p>
<p>service_id: {{ service_id }}</p>
{% endcomment %}

{% comment %}
<div class="jumbotron">
    <h2>{% settings_value "APP_NAME" %}</h2>
    <ul class="nav nav-pills">
        <li><a href="{% url 'services:index' %}">Services</a></li>
        <li><a href="{% url 'services:hosts' %}">Hosts</a></li>
        <li><a href="{% url 'services:export' %}">Export...</a></li>
        {% if service_id == '0' %}
            <li class="active"><a href="#">Add New Service</a></li>
        {% else %}
            <li class="active"><a href="#">Edit Service</a></li>
        {% endif %}
        <li><a href="{% url 'services:view_log' %}">View Log</a></li>
        <li><a href="{% url 'services:metrics' %}">Metrics</a></li>
        <li><a href="{% url 'services:clear_and_logout' %}">Log Out</a></li>
    </ul>
</div>
{% endcomment %}

<form class="form-horizontal" role="form"
    action="{% url 'services:add' %}" method="post">
    {% csrf_token %}

    {# hidden field for service_id; will be 0 if adding new #}
    <input name="service_id" type="hidden" value="{{ service_id }}" />

    {% for field in form %}
        <div class="form-group{% if field.errors %} has-error has-feedback{% endif %}">
            <label for="{{ field.id_for_label }}"
                class="col-sm-2 col-sm-offset-1 control-label">
                {{ field.label }}:
            </label>
            <div class="col-sm-6">
                {{ field }}
                {% if field.errors %}
                <span class="glyphicon glyphicon-remove form-control-feedback">
                </span>
                {% endif %}
            </div>
            {% if field.errors %}
                <span class="error" style="color:#d9534f;">
                    {{ field.errors.0 }}</span>
            {% endif %}

        </div>
    {% endfor %}

    {{ link_formset.management_form }}
    {% for lform in link_formset %}
    <div class="panel panel-default">
    <span class="label label-primary" style="margin-left:10px;">LINK</span>
    <div class="panel-body">
        <div class="form-group{% if lform.url.errors %} has-error has-feedback{% endif %}">
            <label for="{{ lform.url.id_for_label }}"
                class="col-sm-2 col-sm-offset-1 control-label">
                URL:
            </label>
            <div class="col-sm-6">{{ lform.url }}
                {% if lform.url.errors %}
                <span class="glyphicon glyphicon-remove form-control-feedback">
                </span>
                {% endif %}
            </div>
            {% if lform.url.errors %}
                <span class="error" style="color:#d9534f;">
                    {{ lform.url.errors.0 }}</span>
            {% endif %}
        </div>
        <div class="form-group{% if lform.description.errors %} has-error has-feedback{% endif %}">
            <label for="{{ lform.description.id_for_label }}"
                class="col-sm-2 col-sm-offset-1 control-label">
                Description:
            </label>
            <div class="col-sm-6">{{ lform.description }}
                {% if lform.description.errors %}
                <span class="glyphicon glyphicon-remove form-control-feedback">
                </span>
                {% endif %}
            </div>
            {% if lform.description.errors %}
                <span class="error" style="color:#d9534f;">
                    {{ lform.description.errors.0 }}</span>
            {% endif %}
        </div>
    </div> <!-- panel-body -->
    </div> <!-- panel -->
    {% endfor %}

    <div class="row">
        <div class="col-sm-2 col-sm-offset-3">
            {% comment %}
                <span class="glyphicon glyphicon-plus"></span>
            <input class="btn btn-primary" type="submit" name="add_link"
                value="Add Additional Link" />
            <input class="btn" type="submit" name="add_link"
                value="Add Additional Link" />
            {% endcomment %}
            <button type="submit" class="btn btn-default btn-sm" style="color:green;"
                name="add_link">
                <span class="glyphicon glyphicon-plus"></span>
                Add Additional Link
            </button>
        </div>
    </div>

    {{ host_formset.management_form }}
    {% for hform in host_formset %}
    <div class="panel panel-default" style="margin-top:10px;">
    {% comment %}
    <div class="panel-heading">
        <h5 class="panel-heading">Instance</h5>
    </div>
    {% endcomment %}
    <span class="label label-primary" style="margin-left:10px;">HOST</span>


    <div class="panel-body">
    {# <fieldset><legend>Instance</legend> #}
    <div class="form-group">
        <div class="{% if hform.label.errors %}has-error{% endif %}">
        <label for="{{ hform.label.id_for_label }}"
            class="col-sm-2 col-sm-offset-1 control-label">
            Label:
            {% if hform.label.errors %}
            <span style="color:#d9534f;">(Required)</span>
            {% endif %}
        </label>
        <div class="col-sm-2">{{ hform.label }}</div>
        </div>
        <label for="{{ hform.availability.id_for_label }}"
            class="col-sm-1 control-label">
            Availability:
        </label>
        <div class="col-sm-2">{{ hform.availability }}</div>
        <label for="{{ hform.support.id_for_label }}"
            class="col-sm-1 control-label">
            Support:
        </label>
        <div class="col-sm-2">{{ hform.support }}</div>
    </div>
    <div class="form-group{% if hform.location_choice.errors %} has-error has-feedback{% endif %}">
        <label class="col-sm-2 col-sm-offset-1 control-label">
        Location:
        </label>
        <div class="col-sm-4">
            Select from existing:
            {% if hform.location_choice.errors %}
            <span style="color:#d9534f;">(Required)</span>
            {% endif %}
            {{ hform.location_choice }}
        </div>
        <div class="col-sm-4">
            or enter new location:
            {{ hform.location_site }}
        </div>
    </div>
    <div class="form-group">
        <label for="{{ hform.hostname.id_for_label }}"
            class="col-sm-2 col-sm-offset-1 control-label">
        Hostname:
        </label>
        <div class="col-sm-3">
            {{ hform.hostname }}
        </div>
        <label for="{{ ifhrm.ip_address.id_for_label }}"
            class="col-sm-2 control-label">
        IP Address:
        </label>
        <div class="col-sm-3">
            {{ hform.ip_address }}
        </div>
    </div>
    <div class="form-group">
        <label for="{{ hform.qualys.id_for_label }}"
            class="col-sm-2 col-sm-offset-1 control-label">
        Scanned by Qualys:
        </label>
        <div class="col-sm-3">
            {{ hform.qualys}}
        </div>
        <label for="{{ hform.nagios.id_for_label }}"
               class="col-sm-2 control-label">
            Checked by Nagios:
         </label>
         <div class="col-sm-3">
             {{ hform.nagios }}
         </div>
    </div>
    <div class="form-group">
        <label for="{{ hform.host_last_verified.id_for_label }}"
            class="col-sm-2 col-sm-offset-1 control-label">
        Host last verified:
            {% if hform.host_last_verified.errors %}
            <span style="color:#d9534f;">$$$${{hform.host_last_verified}}$$$</span>
            {% endif %}
        </label>
        <div class="col-sm-3">
            {{ hform.host_last_verified}}
        </div>
    </div>
    <div class="form-group{% if hform.sys_admin_choice.errors %} has-error has-feedback{% endif %}">
        <label for="{{ hform.sys_admin.id_for_label }}"
            class="col-sm-2 col-sm-offset-1 control-label">
        Sys Admin:
        </label>
        <div class="col-sm-4">
            Select from existing:
            {% if hform.sys_admin_choice.errors %}
            <span style="color:#d9534f;">(Required)</span>
            {% endif %}
            {{ hform.sys_admin_choice }}
        </div>
        <div class="col-sm-4">
            or enter new staff:
            {{ hform.sys_admin_name }}
            {{ hform.sys_admin_email }}
            {{ hform.sys_admin_phone }}
        </div>
    </div>
    <div class="form-group{% if hform.poc_primary_choice.errors %} has-error has-feedback{% endif %}">
        <label for="{{ hform.poc_primary.id_for_label }}"
            class="col-sm-2 col-sm-offset-1 control-label">
        Primary POC:
        </label>
        <div class="col-sm-4">
            Select from existing:
            {% if hform.poc_primary_choice.errors %}
            <span style="color:#d9534f;">(Required)</span>
            {% endif %}
            {{ hform.poc_primary_choice }}
        </div>
        <div class="col-sm-4">
            or enter new staff:
            {{ hform.poc_primary_name }}
            {{ hform.poc_primary_email }}
            {{ hform.poc_primary_phone }}
        </div>
    </div>
    <div class="form-group{% if hform.poc_backup_choice.errors %} has-error has-feedback{% endif %}">
        <label for="{{ hform.poc_backup.id_for_label }}"
            class="col-sm-2 col-sm-offset-1 control-label">
        Backup POC:
        </label>
        <div class="col-sm-4">
            Select from existing:
            {% if hform.poc_backup_choice.errors %}
            <span style="color:#d9534f;">(Required)</span>
            {% endif %}
            {{ hform.poc_backup_choice }}
        </div>
        <div class="col-sm-4">
            or enter new staff:
            {{ hform.poc_backup_name }}
            {{ hform.poc_backup_email }}
            {{ hform.poc_backup_phone }}
        </div>
    </div>
    <div class="form-group">
        <label for="{{ hform.note.id_for_label }}"
            class="col-sm-2 col-sm-offset-1 control-label">
        Note:
        </label>
        <div class="col-sm-6">
            {{ hform.note }}
        </div>
    </div>

    </div> <!-- panel-body -->
    </div> <!-- panel -->
    {% endfor %}

    {% comment %}
    <div class="field_row">
        <div class="field">
        <span>{{ field.label_tag }}</span>
        {{ field }}
        {% if field.errors %}
        <span class="error">{{ field.errors.0 }}</span>
        {% endif %}
        </div>
    </div>
    {% endcomment %}
    <div class="row">
        <div class="col-sm-2 col-sm-offset-3">
            {% comment %}
            <input class="btn btn-primary" type="submit" name="add_instance"
                value="Add Additional Instance" />
            {% endcomment %}
            <button type="submit" class="btn btn-default btn-sm"
                style="color:green;" name="add_host">
                <span class="glyphicon glyphicon-plus"></span>
                Add Additional Host
            </button>
        </div>
    </div>


<div class="well well-lg" style="margin-top:10px;">
<div class="row">
    {% if privileged %}
    <div class="form-group">
        <label class="col-sm-3 col-sm-offset-4">
            <input name="deprecated" type="checkbox" /> Deprecated
        </label>
    </div>
    {% endif %}
    <div class="col-sm-2 col-sm-offset-4">
    {% if service_id == '0' %}
        <input class="btn btn-primary" type="submit" value="Save New Entry" />
    {% else %}
        <input class="btn btn-primary" type="submit" value="Save Changes" />
    {% endif %}
    </div>
    <div class="col-sm-2">
        <a class="btn btn-default" href="{% url 'services:index' %}"
            role="button">Cancel</a>
    </div>
</div>
</div>

</form>
{% endblock %}

{% block scripts %}
<!-- attach datepicker to failover_last_tested -->
<script type="text/javascript">
    $(document).ready(function(){
        $("#id_failover_last_tested").datepicker();
        $("#id_service_last_verified").datepicker();
        // $( "[id^='id_host-']" ).each(function(){
        //    $(this).datepicker();
        //    });
    });
</script>

{% endblock %}
